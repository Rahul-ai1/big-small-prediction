<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Big/Small Prediction Game</title>
<link rel="icon" href="icon.png" />
<link rel="apple-touch-icon" href="icon.png" />
<meta name="theme-color" content="#121212" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-title" content="Big/Small Game" />
<link rel="manifest" href="manifest.json" />
<style>
  :root {
    --bg-dark: #121212;
    --text-dark: #eee;
    --button-bg-dark: #333;
    --button-text-dark: #fff;
    --accent-dark: #6ef;

    --bg-light: #f5f5f5;
    --text-light: #111;
    --button-bg-light: #ddd;
    --button-text-light: #000;
    --accent-light: #06c;
  }
  /* Basic resets */
  * {
    box-sizing: border-box;
  }
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: var(--bg-dark);
    color: var(--text-dark);
    margin: 0;
    padding: 20px;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    transition: background-color 0.3s ease, color 0.3s ease;
    user-select: none;
  }
  body.light {
    background-color: var(--bg-light);
    color: var(--text-light);
  }
  h1 {
    font-weight: 700;
    font-size: 2.5rem;
    margin: 10px 0 15px;
  }
  #splash {
    position: fixed;
    top:0;left:0;width:100%;height:100%;
    background: var(--bg-dark);
    color: var(--text-dark);
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 1.8rem;
    font-weight: 600;
    z-index: 9999;
  }
  body.light #splash {
    background: var(--bg-light);
    color: var(--text-light);
  }

  /* Theme toggle button */
  #toggleThemeBtn {
    position: fixed;
    top: 15px;
    right: 15px;
    padding: 8px 12px;
    font-size: 1.2rem;
    cursor: pointer;
    border: none;
    border-radius: 6px;
    background-color: var(--button-bg-dark);
    color: var(--button-text-dark);
    transition: background-color 0.3s ease, color 0.3s ease;
    z-index: 10000;
    user-select:none;
  }
  body.light #toggleThemeBtn {
    background-color: var(--button-bg-light);
    color: var(--button-text-light);
  }
  #toggleThemeBtn:hover {
    background-color: var(--accent-dark);
    color: #fff;
  }
  body.light #toggleThemeBtn:hover {
    background-color: var(--accent-light);
    color: #fff;
  }

  /* User greeting and name input */
  #welcome {
    font-size: 1.3rem;
    margin: 10px 0 15px;
  }
  #namePrompt {
    margin: 20px 0;
  }
  #namePrompt input {
    padding: 8px 12px;
    font-size: 1.1rem;
    width: 220px;
    border-radius: 5px;
    border: 1px solid #aaa;
    outline-offset: 2px;
    transition: outline-color 0.3s ease;
  }
  #namePrompt input:focus {
    outline: 2px solid var(--accent-dark);
  }
  #namePrompt button {
    padding: 8px 16px;
    margin-left: 12px;
    font-size: 1.1rem;
    cursor: pointer;
    border: none;
    border-radius: 5px;
    background-color: var(--button-bg-dark);
    color: var(--button-text-dark);
    transition: background-color 0.3s ease, color 0.3s ease;
  }
  body.light #namePrompt button {
    background-color: var(--button-bg-light);
    color: var(--button-text-light);
  }
  #namePrompt button:hover {
    background-color: var(--accent-dark);
    color: #fff;
  }
  body.light #namePrompt button:hover {
    background-color: var(--accent-light);
    color: #fff;
  }

  /* Coins, score, stats */
  #coins, #scoreboard, #winLossStats {
    font-size: 1.3rem;
    font-weight: 600;
    margin: 10px 0;
  }

  /* Prediction buttons */
  .prediction-buttons {
    margin: 25px 0;
  }
  button.prediction {
    font-size: 1.5rem;
    padding: 15px 40px;
    margin: 0 15px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    font-weight: 700;
    background-color: var(--button-bg-dark);
    color: var(--button-text-dark);
    transition: background-color 0.3s ease, color 0.3s ease;
    user-select:none;
  }
  body.light button.prediction {
    background-color: var(--button-bg-light);
    color: var(--button-text-light);
  }
  button.prediction:hover:not(:disabled) {
    background-color: var(--accent-dark);
    color: #fff;
  }
  body.light button.prediction:hover:not(:disabled) {
    background-color: var(--accent-light);
    color: #fff;
  }
  button.prediction:disabled {
    cursor: not-allowed;
    opacity: 0.5;
  }

  /* Result area */
  #result {
    margin: 20px 0 10px;
    font-size: 1.7rem;
    font-weight: 700;
    min-height: 48px;
    user-select:none;
  }

  /* Countdown timer & animation */
  #countdown {
    font-size: 1.2rem;
    margin-top: 10px;
    user-select:none;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 12px;
  }
  #timerCircle {
    width: 40px;
    height: 40px;
    position: relative;
  }
  svg {
    transform: rotate(-90deg);
  }
  circle {
    fill: none;
    stroke-width: 5;
  }
  #timerBackground {
    stroke: #888;
    opacity: 0.3;
  }
  #timerProgress {
    stroke: var(--accent-dark);
    transition: stroke-dashoffset 1s linear;
  }
  body.light #timerProgress {
    stroke: var(--accent-light);
  }

  /* Share buttons container */
  #shareContainer {
    margin-top: 20px;
    display: flex;
    gap: 16px;
    justify-content: center;
  }
  .share-btn {
    background-color: var(--button-bg-dark);
    color: var(--button-text-dark);
    border: none;
    padding: 10px 18px;
    border-radius: 6px;
    font-size: 1.1rem;
    cursor: pointer;
    user-select:none;
    transition: background-color 0.3s ease, color 0.3s ease;
  }
  body.light .share-btn {
    background-color: var(--button-bg-light);
    color: var(--button-text-light);
  }
  .share-btn:hover {
    background-color: var(--accent-dark);
    color: #fff;
  }
  body.light .share-btn:hover {
    background-color: var(--accent-light);
    color: #fff;
  }

  /* Responsive */
  @media (max-width: 480px) {
    button.prediction {
      padding: 12px 24px;
      margin: 10px 8px;
      font-size: 1.3rem;
    }
    #namePrompt input {
      width: 140px;
    }
  }
</style>
</head>
<body>
  <!-- Splash screen -->
  <div id="splash">üîÆ Big/Small Prediction Game Loading...</div>

  <!-- Theme toggle -->
  <button id="toggleThemeBtn" aria-label="Toggle Theme">üåó Toggle Theme</button>

  <h1>Big / Small Prediction</h1>

  <!-- User greeting -->
  <div id="welcome"></div>

  <!-- Name input prompt -->
  <div id="namePrompt" style="display:none;">
    <p>Please enter your name:</p>
    <input id="nameInput" placeholder="Your name" autocomplete="off" />
    <button id="saveNameBtn">Save</button>
  </div>

  <!-- Score and coins -->
  <div id="coins">üí∞ Coins: 100</div>
  <div id="scoreboard">üèÜ Score: 0</div>
  <div id="winLossStats">‚úîÔ∏è Wins: 0 &nbsp;&nbsp; ‚ùå Losses: 0</div>

  <!-- Prediction buttons -->
  <div class="prediction-buttons">
    <button id="btnSmall" class="prediction">Small (0-4)</button>
    <button id="btnBig" class="prediction">Big (5-9)</button>
  </div>

  <!-- Result display -->
  <div id="result"></div>

  <!-- Countdown timer -->
  <div id="countdown">
    Next round in: <span id="timer">20</span> seconds
    <div id="timerCircle">
      <svg width="40" height="40" viewBox="0 0 36 36">
        <circle id="timerBackground" cx="18" cy="18" r="16"></circle>
        <circle id="timerProgress" cx="18" cy="18" r="16" stroke-dasharray="100" stroke-dashoffset="0"></circle>
      </svg>
    </div>
  </div>

  <!-- Share buttons -->
  <div id="shareContainer">
    <button id="shareWhatsApp" class="share-btn" aria-label="Share on WhatsApp">üì≤ WhatsApp</button>
    <button id="shareTwitter" class="share-btn" aria-label="Share on Twitter">üê¶ Twitter</button>
  </div>

<script>
(() => {
  const splash = document.getElementById('splash');
  const body = document.body;
  const toggleThemeBtn = document.getElementById('toggleThemeBtn');
  const welcome = document.getElementById('welcome');
  const namePrompt = document.getElementById('namePrompt');
  const nameInput = document.getElementById('nameInput');
  const saveNameBtn = document.getElementById('saveNameBtn');

  const coinsDisplay = document.getElementById('coins');
  const scoreDisplay = document.getElementById('scoreboard');
  const winLossStats = document.getElementById('winLossStats');

  const btnSmall = document.getElementById('btnSmall');
  const btnBig = document.getElementById('btnBig');
  const result = document.getElementById('result');

  const timerSpan = document.getElementById('timer');
  const timerProgress = document.getElementById('timerProgress');

  const shareWhatsApp = document.getElementById('shareWhatsApp');
  const shareTwitter = document.getElementById('shareTwitter');

  const maxTime = 20; // seconds
  let timeLeft = maxTime;
  let timerInterval = null;

  // Game state
  let coins = 100;
  let score = 0;
  let wins = 0;
  let losses = 0;
  let userName = null;

  // Sounds (beeps for win/loss)
  const soundWin = new Audio('https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg');
  const soundLoss = new Audio('https://actions.google.com/sounds/v1/cartoon/boing.ogg');

  // Load saved data
  function loadData() {
    coins = parseInt(localStorage.getItem('coins')) || 100;
    score = parseInt(localStorage.getItem('score')) || 0;
    wins = parseInt(localStorage.getItem('wins')) || 0;
    losses = parseInt(localStorage.getItem('losses')) || 0;
    userName = localStorage.getItem('userName') || null;
    theme = localStorage.getItem('theme') || 'dark';
    updateTheme(theme);
  }

  // Save data
  function saveData() {
    localStorage.setItem('coins', coins);
    localStorage.setItem('score', score);
    localStorage.setItem('wins', wins);
    localStorage.setItem('losses', losses);
    if(userName) localStorage.setItem('userName', userName);
  }

  // Update UI for coins, score, stats
  function updateStatsUI() {
    coinsDisplay.textContent = `üí∞ Coins: ${coins}`;
    scoreDisplay.textContent = `üèÜ Score: ${score}`;
    winLossStats.textContent = `‚úîÔ∏è Wins: ${wins}  ‚ùå Losses: ${losses}`;
  }

  // Update theme UI
  function updateTheme(theme) {
    if(theme === 'light') {
      body.classList.add('light');
      toggleThemeBtn.textContent = 'üåô Dark Mode';
      localStorage.setItem('theme', 'light');
    } else {
      body.classList.remove('light');
      toggleThemeBtn.textContent = 'üåó Light Mode';
      localStorage.setItem('theme', 'dark');
    }
  }

  // Toggle theme button event
  toggleThemeBtn.addEventListener('click', () => {
    if(body.classList.contains('light')) {
      updateTheme('dark');
    } else {
      updateTheme('light');
    }
  });

  // Show welcome message or prompt name input
  function showWelcomeOrPrompt() {
    if(userName) {
      welcome.textContent = `Hello, ${userName}! Ready to play?`;
      namePrompt.style.display = 'none';
      enablePredictionButtons(true);
    } else {
      welcome.textContent = '';
      namePrompt.style.display = 'block';
      enablePredictionButtons(false);
    }
  }

  // Save name button click
  saveNameBtn.addEventListener('click', () => {
    const val = nameInput.value.trim();
    if(val.length >= 2 && val.length <= 20) {
      userName = val;
      localStorage.setItem('userName', userName);
      nameInput.value = '';
      showWelcomeOrPrompt();
    } else {
      alert('Please enter a valid name (2-20 characters).');
      nameInput.focus();
    }
  });

  // Enable/Disable prediction buttons
  function enablePredictionButtons(enable) {
    btnSmall.disabled = !enable;
    btnBig.disabled = !enable;
  }

  // Ethereum block hash fetch (fallback to random number if fails)
  async function getRandomDigit() {
    try {
      // Use public Ethereum block explorer API
      const response = await fetch('https://api.blockcypher.com/v1/eth/main');
      if(!response.ok) throw new Error('API error');
      const data = await response.json();
      const blockHash = data.hash;
      // Extract last hex char and convert to decimal (0-15)
      let lastChar = blockHash.slice(-1);
      let digit = parseInt(lastChar, 16);
      // For our game: number 0-9; if >9, mod 10
      digit = digit % 10;
      return digit;
    } catch(e) {
      // fallback random number 0-9
      return Math.floor(Math.random() * 10);
    }
  }

  // Game round logic
  async function playRound(prediction) {
    if(coins < 1) {
      result.textContent = "You're out of coins! Refresh to restart.";
      enablePredictionButtons(false);
      clearInterval(timerInterval);
      return;
    }
    enablePredictionButtons(false);
    result.textContent = 'Waiting for result... üîÑ';
    const number = await getRandomDigit();

    // Determine result: small = 0-4, big = 5-9
    const isSmall = number <= 4;
    const correct = (prediction === 'small' && isSmall) || (prediction === 'big' && !isSmall);

    // Update coins and score
    if(correct) {
      coins += 10;  // win 10 coins
      score += 10;
      wins++;
      result.textContent = `üéâ You won! Number was ${number} (${isSmall ? 'Small' : 'Big'})`;
      soundWin.play();
    } else {
      coins -= 5;  // lose 5 coins
      score = Math.max(0, score - 5);
      losses++;
      result.textContent = `üòû You lost! Number was ${number} (${isSmall ? 'Small' : 'Big'})`;
      soundLoss.play();
    }

    saveData();
    updateStatsUI();

    // Start next round timer
    startTimer();
  }

  // Timer circle animation calculations
  const circumference = 2 * Math.PI * 16; // r=16

  function setTimerCircle(percent) {
    const offset = circumference * (1 - percent / 100);
    timerProgress.style.strokeDasharray = circumference;
    timerProgress.style.strokeDashoffset = offset;
  }

  // Timer countdown and start next round
  function startTimer() {
    timeLeft = maxTime;
    timerSpan.textContent = timeLeft;
    setTimerCircle(100);
    enablePredictionButtons(true);

    clearInterval(timerInterval);
    timerInterval = setInterval(() => {
      timeLeft--;
      timerSpan.textContent = timeLeft;
      setTimerCircle((timeLeft / maxTime) * 100);
      if(timeLeft <= 0) {
        clearInterval(timerInterval);
        // Auto play round with random prediction if user did not click
        enablePredictionButtons(false);
        const autoPrediction = Math.random() > 0.5 ? 'big' : 'small';
        result.textContent = "Time's up! Auto-playing round...";
        setTimeout(() => playRound(autoPrediction), 1000);
      }
    }, 1000);
  }

  // Button click events
  btnSmall.addEventListener('click', () => {
    if(coins < 1) return;
    playRound('small');
  });
  btnBig.addEventListener('click', () => {
    if(coins < 1) return;
    playRound('big');
  });

  // Share buttons handlers
  function getShareText() {
    return `${userName || 'I'} just played the Big/Small Prediction Game! üé≤ Can you beat my score of ${score} and coins ${coins}? Try it now!`;
  }
  shareWhatsApp.addEventListener('click', () => {
    const text = encodeURIComponent(getShareText());
    const url = `https://wa.me/?text=${text}`;
    window.open(url, '_blank');
  });
  shareTwitter.addEventListener('click', () => {
    const text = encodeURIComponent(getShareText());
    const url = `https://twitter.com/intent/tweet?text=${text}`;
    window.open(url, '_blank');
  });

  // Initialize app
  function init() {
    loadData();
    showWelcomeOrPrompt();
    updateStatsUI();
    startTimer();

    // Splash screen hide after 1 second
    setTimeout(() => {
      splash.style.display = 'none';
    }, 1000);
  }

  // Start app
  init();
})();
</script>
</body>
</html>
