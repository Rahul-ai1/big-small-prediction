<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Big/Small Prediction Game</title>
  <link rel="icon" href="icon.png" />
  <link rel="apple-touch-icon" href="icon.png" />
  <meta name="theme-color" content="#121212" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-title" content="Big/Small Game" />
  <link rel="manifest" href="manifest.json" />

  <style>
    :root {
      --bg-dark: #121212;
      --text-dark: #ffffff;
      --button-bg-dark: #333;
      --button-text-dark: #fff;

      --bg-light: #f5f5f5;
      --text-light: #000000;
      --button-bg-light: #ddd;
      --button-text-light: #000;
    }

    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: var(--bg-dark);
      color: var(--text-dark);
      text-align: center;
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    body.light {
      background-color: var(--bg-light);
      color: var(--text-light);
    }

    h1 {
      font-size: 2rem;
      margin-top: 20px;
    }

    #splash {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: var(--bg-dark);
      color: var(--text-dark);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      font-size: 1.5rem;
      user-select: none;
    }

    body.light #splash {
      background: var(--bg-light);
      color: var(--text-light);
    }

    button {
      padding: 10px 20px;
      margin: 10px 5px;
      font-size: 1rem;
      cursor: pointer;
      background-color: var(--button-bg-dark);
      color: var(--button-text-dark);
      border: none;
      border-radius: 5px;
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    body.light button {
      background-color: var(--button-bg-light);
      color: var(--button-text-light);
    }

    #result {
      margin: 20px;
      font-size: 1.3rem;
      min-height: 2rem;
    }

    #countdown {
      font-size: 1.2rem;
      color: #ccc;
      margin-bottom: 10px;
    }

    #scoreboard, #coins {
      font-size: 1.2rem;
      margin: 10px;
    }

    #namePrompt {
      margin: 20px 0;
    }

    input#nameInput {
      padding: 8px;
      font-size: 1rem;
      border-radius: 4px;
      border: 1px solid #ccc;
      width: 150px;
      margin-right: 10px;
    }
  </style>
</head>
<body>
  <div id="splash">üîÆ Big/Small Prediction Game Loading...</div>

  <h1>Big / Small Prediction Game</h1>

  <div id="welcome"></div>

  <div id="namePrompt" style="display:none;">
    <p>Please enter your name:</p>
    <input id="nameInput" placeholder="Your name" />
    <button onclick="saveName()">Save</button>
  </div>

  <div id="coins">üí∞ Coins: 100</div>
  <div id="scoreboard">üèÜ Score: 0</div>

  <div>
    <button onclick="makePrediction('small')">Small (0-4)</button>
    <button onclick="makePrediction('big')">Big (5-9)</button>
  </div>

  <div id="result"></div>

  <div id="countdown">Next round in: <span id="timer">20</span> seconds</div>

  <button onclick="runGame()">Play Now</button>
  <button onclick="toggleTheme()">üåó Toggle Theme</button>

  <script>
    // Splash screen hide after load
    window.onload = () => {
      setTimeout(() => {
        document.getElementById('splash').style.display = 'none';
      }, 1000);
    };

    // Theme toggle and storage
    if(localStorage.getItem('theme') === 'light') {
      document.body.classList.add('light');
    }

    function toggleTheme() {
      document.body.classList.toggle('light');
      localStorage.setItem('theme', document.body.classList.contains('light') ? 'light' : 'dark');
    }

    // User data and coins
    let userName = localStorage.getItem('userName') || null;
    let userCoins = parseInt(localStorage.getItem('userCoins') || "100");
    let userScore = parseInt(localStorage.getItem('userScore') || "0");
    let prediction = null;

    // UI update
    function updateUI() {
      document.getElementById("coins").innerText = "üí∞ Coins: " + userCoins;
      document.getElementById("scoreboard").innerText = "üèÜ Score: " + userScore;
      if(userName) {
        document.getElementById("welcome").innerHTML = `üëã Welcome, <strong>${userName}</strong>!`;
        document.getElementById("namePrompt").style.display = "none";
      } else {
        document.getElementById("welcome").innerHTML = "";
        document.getElementById("namePrompt").style.display = "block";
      }
    }

    function saveName() {
      const input = document.getElementById("nameInput");
      const name = input.value.trim();
      if(name.length > 0) {
        userName = name;
        localStorage.setItem("userName", userName);
        updateUI();
      } else {
        alert("Please enter a valid name.");
      }
    }

    function saveProgress() {
      localStorage.setItem("userCoins", userCoins);
      localStorage.setItem("userScore", userScore);
    }

    function makePrediction(value) {
      if(userCoins < 10) {
        alert("You don't have enough coins to bet!");
        return;
      }
      prediction = value;
      document.getElementById('result').innerText = `You picked ${value.toUpperCase()}`;
    }

    async function fetchLastDigitFromHash() {
      try {
        const response = await fetch('https://api.blockcypher.com/v1/eth/main');
        const data = await response.json();
        const hash = data.hash;
        const lastDigit = parseInt(hash.slice(-1), 16) % 10;
        return lastDigit;
      } catch (e) {
        // fallback random digit 0-9
        return Math.floor(Math.random() * 10);
      }
    }

    async function runGame() {
      if(!prediction) {
        alert("Please make a prediction first!");
        return;
      }

      if(userCoins < 10) {
        alert("You don't have enough coins to bet!");
        return;
      }

      const lastDigit = await fetchLastDigitFromHash();
      const outcome = lastDigit <= 4 ? 'small' : 'big';

      if(prediction === outcome) {
        userScore++;
        userCoins += 10;
        document.getElementById('result').innerText = `üéâ You WON! Number was ${lastDigit} (${outcome.toUpperCase()})`;
      } else {
        userCoins = Math.max(0, userCoins - 10);
        document.getElementById('result').innerText = `‚ùå You LOST! Number was ${lastDigit} (${outcome.toUpperCase()})`;
      }

      prediction = null;

      saveProgress();
      updateUI();

      if(userCoins <= 0) {
        alert("You are out of coins! Refresh to reset.");
      }
    }

    // Countdown timer for auto play every 20 seconds
    let countdown = 20;
    setInterval(() => {
      countdown--;
      document.getElementById('timer').innerText = countdown;
      if(countdown <= 0) {
        countdown = 20;
        runGame();
      }
    }, 1000);

    updateUI();
  </script>
</body>
</html>
